---
title: "Correlations"
output: html_notebook
---

```{r setup}
knitr::opts_chunk$set(
  echo = FALSE,
  fig.width = 10,
  fig.height = 5
)
```

```{r message=FALSE}
library(tidyverse)
library(patchwork)
```

```{r}
source("fn.R")
source("fn2.R")
```

```{r}
mhsurv <- readRDS("../data/2-final/mh_survey_results.rds")
```

# Correlation matrix

<!-- ```{r} -->
<!-- df <- mhsurv |> -->
<!--   select(q4_1:last_col()) |> -->
<!--   select(-starts_with("q11_"), -ends_with("bin")) |> -->
<!--   mutate(across(everything(), as.numeric)) -->
<!-- ``` -->

<!-- ```{r} -->
<!-- cormat <- rstatix::cor_mat(df) -->
<!-- ``` -->

# SM use vs SM addiction

```{r}
cor1 <- cor_tests(mhsurv, "sm_use_num", "sm_add_num")
```

```{r}
print(cor1)
```

# SM use vs hours slept

```{r}
cor2 <- cor_tests(mhsurv, "sm_use_num", "hrs_slept_num")
```

```{r}
print(cor2)
```

# SM use vs time to fall asleep

```{r}
cor3 <- cor_tests(mhsurv, "sm_use_num", "min_to_sleep_num")
```

```{r}
print(cor3)
```

# SM addiction vs time to fall asleep

```{r}
cor3 <- cor_tests(mhsurv, "sm_add_num", "min_to_sleep_num")
```

```{r}
print(cor3)
```

# Reported vs calculated time to fall asleep

```{r}
mhsurv <- mhsurv |>
  mutate(
    min_to_sleep_calc = (hrs_in_bed - hrs_slept_num) * 60,
    min_to_sleep_diff = min_to_sleep_num - min_to_sleep_calc
  )
```

```{r}
df <- mhsurv |>
  summarize(
    "Non-NA MTS diff" = sum(!is.na(min_to_sleep_diff)),
    "Unequal MTS" = sum(min_to_sleep_diff != 0, na.rm = TRUE),
    "MTS diff >= 5" = sum(min_to_sleep_diff >= 5, na.rm = TRUE),
    "MTS diff >= 15" = sum(min_to_sleep_diff >= 15, na.rm = TRUE),
    "MTS diff >= 30" = sum(min_to_sleep_diff >= 30, na.rm = TRUE)
  )

rownames(df) <- "Responses (n)"

t(df)
```




